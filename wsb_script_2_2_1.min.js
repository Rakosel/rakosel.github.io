var e=!1,t,s,n=!1,c,d,o,p,a,_,h="",r="",l={},m={},b={},i=0,u=!1,g=0,f=0,v=2e3,I=[],N=[],M=[],w=[];I=[0,1,2,4,5,16,17,20];M=[3,8,9,18,19,21];N=[6,7,12,13];var E,O,k;E=$(".sideset");O=$(".macnt");k=$(".setcnt");cnftmp=$(".scntf");function G(){var e="/otp_mode?input="+encodeURIComponent("Wr345")+"&";ae(e,"GET",V,30)}function C(){var e=$("#btnsens_val").t(),t;if(1!=g)for(t=0;t<e;t++){var s="/otp_mode?input="+encodeURIComponent("GiveMeas")+"&";ae(s,"GET",V,50)}}function R(){var e="/otp_mode?input="+encodeURIComponent("Rd345")+"&";ae(e,"GET",V,30)}function T(){0==n&&$("#autmp").o("checked")&&(ae("/get_rtc.json?n="+Math.random(),"GET",V,30),ie())}function x(){var e={_:[Math.floor(Date.now()/1e3),0,0]};ae("/set_rtc.json?n="+encodeURIComponent(JSON.stringify(e))+"&","GET",V,10)}function j(){var e=$("#htu21d_ht option:selected").t(),t=$("#htu21d_m option:selected").t();$(".btns_htu21d").l("badge-success");$(".btns_htu21d").l("badge-danger");ae("/input_htu21d.json?n="+encodeURIComponent(JSON.stringify({$:[t,e]}))+"&","GET",V,10)}function F(){$(".btns_htu21d").l("badge-success");$(".btns_htu21d").l("badge-danger");ae("/output_htu21d.json?n="+Math.random(),"GET",V,10)}function U(){var e=$("#sht30_ht option:selected").t(),t=$("#sht30_m option:selected").t(),s=$("#sht30_scr option:selected").t(),n=$("#sht30_rep option:selected").t(),c=$("#sht30_mps_sel option:selected").t();$(".btns_sht30").l("badge-success");$(".btns_sht30").l("badge-danger");input_sht30={i:[e,t,s,n,c]};ae("/input_sht30_1.json?n="+encodeURIComponent(JSON.stringify(input_sht30))+"&","GET",V,10)}function y(){var e=$("#sht31_ht option:selected").t(),t=$("#sht31_m option:selected").t(),s=$("#sht31_scr option:selected").t(),n=$("#sht31_rep option:selected").t(),c=$("#sht31_mps_sel option:selected").t();$(".btns_sht31").l("badge-success");$(".btns_sht31").l("badge-danger");input_sht31={u:[e,t,s,n,c]};ae("/input_sht30_2.json?n="+encodeURIComponent(JSON.stringify(input_sht31))+"&","GET",V,10)}function S(){$(".btns_sht30_1").l("badge-success");$(".btns_sht30_1").l("badge-danger");ae("/output_sht30_1.json?n="+Math.random(),"GET",V,10)}function J(){$(".btns_sht31").l("badge-success");$(".btns_sht31").l("badge-danger");ae("/output_sht30_2.json?n="+Math.random(),"GET",V,10)}function K(){var e=$("#bm1s_m option:selected").t(),t=$("#bm1s_osrs option:selected").t(),s=$("#bm1s_f option:selected").t(),n=$("#bm1_t_st option:selected").t(),c=$("#bm_alt").t();$(".btns_bme280_1").l("badge-success");$(".btns_bme280_1").l("badge-danger");0==$.p(c)?$(".btns_bme280_1").h("badge-danger").text("Ошибка (смотри выше)"):(input_bme280={m:[e,t,s,n,c]},ae("/input_bme280_1.json?n="+encodeURIComponent(JSON.stringify(input_bme280))+"&","GET",V,10))}function L(){var e=$("#bm2s_m option:selected").t(),t=$("#bm2s_osrs option:selected").t(),s=$("#bm2s_f option:selected").t(),n=$("#bm2_t_st option:selected").t(),c=$("#bm_alt").t();$(".btns_bme280_2").l("badge-success");$(".btns_bme280_2").l("badge-danger");0==$.p(c)?$(".btns_bme280_2").h("badge-danger").text("Ошибка (смотри выше)"):(input_bme280={m:[e,t,s,n,c]},ae("/input_bme280_2.json?n="+encodeURIComponent(JSON.stringify(input_bme280))+"&","GET",V,10))}function B(){$(".btns_bme280_1").l("badge-success");$(".btns_bme280_1").l("badge-danger");ae("/output_bme280_1.json?n="+Math.random(),"GET",V,10)}function A(){$(".btns_bme280_2").l("badge-success");$(".btns_bme280_2").l("badge-danger");ae("/output_bme280_2.json?n="+Math.random(),"GET",V,10)}function V(e,t){var s=$(".pst1"),n=$(".pst0"),c=0,d=0,o=0,a=0,_=0,l=0;if(200!=e)return n.l("badge-success"),n.h("badge-danger"),n.text("Нет связи"),s.l("badge-success"),s.h("badge-danger"),s.text("Нет связи"),$(".swdeb").g("disabled"),z(),0;n.l("badge-danger");s.l("badge-danger");n.h("badge-success");s.h("badge-success");n.text("ОК ");s.text("ОК ");if("string"===typeof t)try{m=JSON.parse(t)}catch(e){return X(""),0}else return X(""),0;if(m.v)try{var b=parseInt(m.v[0].trim(),10),i=parseInt(m.v[1].trim(),10);1==b?$("#lm75_t1_chk").o("checked",!0):$("#lm75_t1_chk").o("checked",!1);1==i?$("#lm75_t2_chk").o("checked",!0):$("#lm75_t2_chk").o("checked",!1)}catch(e){}m.I&&("OK"==m.I?$(".btns_lm75_1").h("badge-success").text("ОК "):$(".btns_lm75_1").h("badge-danger").text("Ошибка "));if(m.N)if(999!=parseInt(m.N[1].trim(),10)||999!=parseInt(m.N[0].trim(),10)){b=parseInt(m.N[1].trim(),10);i=parseInt(m.N[2].trim(),10);$(".lm75thy_1").text(b+" °C");$(".lm75tos_1").text(i+" °C");$("#lm75sc_1").t(b);$("#lm75so_1").t(i);n=parseInt(m.N[0].trim(),10);if($.p(n))for(b=0;4>=b;b++)n&1<<b?$("#gLM75ch"+b.toString()).o("checked",!0):$("#gLM75ch"+b.toString()).o("checked",!1);$(".btns_lm75_1").h("badge-success").text("ОК ")}else $(".btns_lm75_1").h("badge-danger").text("Ошибка ");if(m.M)if(999!=parseInt(m.M[1].trim(),10)||999!=parseInt(m.M[0].trim(),10)){b=parseInt(m.M[1].trim(),10);i=parseInt(m.M[2].trim(),10);$(".lm75thy_2").text(b+"°C");$(".lm75tos_2").text(i+"°C");$("#lm75sc_2").t(b);$("#lm75so_2").t(i);n=parseInt(m.M[0].trim(),10);if($.p(n))for(b=0;4>=b;b++)n&1<<b?$("#gLM752ch"+b.toString()).o("checked",!0):$("#gLM752ch"+b.toString()).o("checked",!1);$(".btns_lm75_2").h("badge-success").text("ОК ")}else $(".btns_lm75_2").h("badge-danger").text("Ошибка ");m.O&&("OK"==m.O?$(".btns_lm75_2").h("badge-success").text("ОК "):$(".btns_lm75_2").h("badge-danger").text("Ошибка "));m.k&&("OK"==m.k?$(".btns_bme280_1").h("badge-success").text("ОК "):$(".btns_bme280_1").h("badge-danger").text("Ошибка "));m.G&&("OK"==m.G?$(".btns_bme280_2").h("badge-success").text("ОК "):$(".btns_bme280_2").h("badge-danger").text("Ошибка "));if(m.C){g=0;if("#ERR"==m.C){g=1;r="";return}if("#OVF"==m.C){g=1;$("#esp_urx").t(r+"#OVF");r="";return}r=$("#esp_urx").t().toString()+m.C+"\n";$("#esp_urx").t(r)}m.R&&("OK"==m.R?($(".btns_otp").l("badge-danger"),$(".btns_otp").h("badge-success").text("ОК ")):($(".btns_otp").l("badge-success"),$(".btns_otp").h("badge-danger").text("Ошибка Wr345")));m.T&&("OK"==m.T?($(".btns_otp").l("badge-danger"),$(".btns_otp").h("badge-success").text("ОК ")):($(".btns_otp").l("badge-success"),$(".btns_otp").h("badge-danger").text("Ошибка Rd345")));m.j&&("OK"==m.j?$(".btns_htu21d").h("badge-success").text("ОК "):$(".btns_htu21d").h("badge-danger").text("Ошибка "));m.$&&(999!=parseInt(m.$[0],10)?($("#htu21d_st").t("0x"+Number(m.$[0]).toString(16).toUpperCase()),parseInt(m.$[0],10),$("#htu21d_m option").F("selected"),$("#htu21d_ht option").F("selected"),$("#htu21d_m [value="+m.$[0]+"]").o("selected","selected"),$("#htu21d_ht [value="+m.$[1]+"]").o("selected","selected"),$(".btns_htu21d").h("badge-success").text("ОК ")):$(".btns_htu21d").h("badge-danger").text("Ошибка "));m.U&&("OK"==m.U?$(".btns_sht30").h("badge-success").text("ОК "):$(".btns_sht30").h("badge-danger").text("Ошибка "));m.S&&("OK"==m.S?$(".btns_sht31").h("badge-success").text("ОК "):$(".btns_sht31").h("badge-danger").text("Ошибка "));m.J&&(999!=parseInt(m.J[0],10)?($("#sht30_st").t("0x"+Number(m.J[0].trim()).toString(16).toUpperCase()),parseInt(m.J[0].trim(),10),$("#sht30_ht option").F("selected"),$("#sht30_m option").F("selected"),$("#sht30_scr option").F("selected"),$("#sht30_rep option").F("selected"),$("#sht30_mps_sel option").F("selected"),$("#sht30_ht [value="+m.J[1]+"]").o("selected","selected"),$("#sht30_m [value="+m.J[2]+"]").o("selected","selected"),$("#sht30_rep [value="+m.J[3]+"]").o("selected","selected"),$("#sht30_mps_sel [value="+m.J[4]+"]").o("selected","selected"),$("#sht30_scr [value="+m.J[5]+"]").o("selected","selected"),$("#sht30_m").click(),$(".btns_sht30").h("badge-success").text("ОК ")):$(".btns_sht30").h("badge-danger").text("Ошибка "));m.K&&(999!=parseInt(m.K[0],10)?($("#sht31_st").t("0x"+Number(m.K[0]).toString(16).toUpperCase()),parseInt(m.K[0],10),$("#sht31_ht option").F("selected"),$("#sht31_m option").F("selected"),$("#sht31_scr option").F("selected"),$("#sht31_rep option").F("selected"),$("#sht31_mps_sel option").F("selected"),$("#sht31_ht [value="+m.K[1]+"]").o("selected","selected"),$("#sht31_m [value="+m.K[2]+"]").o("selected","selected"),$("#sht31_rep [value="+m.K[3]+"]").o("selected","selected"),$("#sht31_mps_sel [value="+m.K[4]+"]").o("selected","selected"),$("#sht31_scr [value="+m.K[5]+"]").o("selected","selected"),$("#sht31_m").click(),$(".btns_sht31").h("badge-success").text("ОК ")):$(".btns_sht31").h("badge-danger").text("Ошибка "));if(m.L)if(999!=parseInt(m.L[1],10)||999!=parseInt(m.L[0].trim(),10)){$("#bm1_ch").t("0x"+Number(m.L[0].trim()).toString(16).toUpperCase());var u=parseInt(m.L[1],10);$("#bm1_st").t("0x"+Number(m.L[1].trim()).toString(16).toUpperCase());$.p(u)&&(u&1?$("#gBM2801ch0").o("checked",!0):$("#gBM2801ch0").o("checked",!1),u&8?$("#gBM2801ch3").o("checked",!0):$("#gBM2801ch3").o("checked",!1),$("#bm1s_m option").F("selected"),$("#bm1s_osrs option").F("selected"),$("#bm1s_f option").F("selected"),$("#bm1_t_st option").F("selected"),$("#bm1s_m [value="+m.L[2]+"]").o("selected","selected"),$("#bm1s_osrs [value="+m.L[3]+"]").o("selected","selected"),$("#bm1s_f [value="+m.L[4]+"]").o("selected","selected"),$("#bm1_t_st [value="+m.L[5]+"]").o("selected","selected"),$(".btns_bme280_1").h("badge-success").text("ОК "))}else $("#bm1_ch").t("Ошибка"),$("#bm1_st").t("Ошибка"),$(".btns_bme280_1").h("badge-danger").text("Ошибка ");m.B&&(999!=parseInt(m.B[1],10)||999!=parseInt(m.B[0].trim(),10)?($("#bm2_ch").t("0x"+Number(m.B[0]).toString(16).toUpperCase().trim()),n=parseInt(m.B[1],10),$("#bm2_st").t("0x"+Number(m.B[1]).toString(16).toUpperCase().trim()),$.p(n)&&(n&1?$("#gBM2802ch0").o("checked",!0):$("#gBM2802ch0").o("checked",!1),u&8?$("#gBM2802ch3").o("checked",!0):$("#gBM2802ch3").o("checked",!1),$("#bm2s_m option").F("selected"),$("#bm2s_osrs option").F("selected"),$("#bm2s_f option").F("selected"),$("#bm2_t_st option").F("selected"),$("#bm2s_m [value="+m.B[2]+"]").o("selected","selected"),$("#bm2s_osrs [value="+m.B[3]+"]").o("selected","selected"),$("#bm2s_f [value="+m.B[4]+"]").o("selected","selected"),$("#bm2_t_st [value="+m.B[5]+"]").o("selected","selected"),$(".btns_bme280_2").h("badge-success").text("ОК "))):($("#bm2_ch").t("Ошибка"),$("#bm2_st").t("Ошибка"),$(".btns_bme280_2").h("badge-danger").text("Ошибка ")));if(m.A){for(b=3;b<=p.length&&b-3<=m.A.length;b++)"#ERR"==m.A[b-3]||""==m.A[b-3]||NaN==m.A[b-3]?q(b):W(b),$("#"+p[b].name).t(m.A[b-3]),w[b-3]=parseFloat(m.A[b-3]);for(b=0;b<w.length;b++)b<I.length&&NaN!=parseFloat(w[I[b]])&&(c+=Math.abs(parseFloat(w[I[b]])),a++),b<M.length&&NaN!=parseFloat(w[M[b]])&&(d+=parseFloat(w[M[b]]),_++),b<N.length&&NaN!=parseFloat(w[N[b]])&&(o+=parseFloat(w[N[b]]),l++);c/=a;d/=_;o/=l;q(0);q(1);q(2);NaN==c?q(0):W(0);NaN==o?q(1):W(1);NaN==d?q(2):W(2);$("#temperature").t(c.toString().substring(0,6));$("#humudity").t(d.toString().substring(0,6));$("#pressure").t(o.toString().substring(0,6))}$("#tm_adc").l("is-invalid").V();$("#tm_adc").l("is-valid").V();m.W&&($("#tm_adc").t(m.W),""==m.W||"#ERR"==m.W?$("#tm_adc").h("is-invalid").V():$("#tm_adc").h("is-valid").V());d=parseFloat($("#htu21_t").t());c=parseFloat($("#htu21_h").t());o=1.359*Math.pow(10,8)*Math.pow(10,-1762.39/(d+235.66));d=(133.32*o/1e3).toString();$("#htu21_pp").t(d.substring(0,5));c=(-(1762.39/(Math.log(.01*c*o)-8.1332)+235.66)).toString();$("#htu21_dew").t(c.substring(0,5));if("NaN"==d||"NaN"==c||""==d||""==c)$("#htu21_dew").l("is-invalid").V(),$("#htu21_dew").l("is-valid").V(),$("#htu21_dew").h("is-invalid").V(),$("#htu21_pp").l("is-invalid").V(),$("#htu21_pp").l("is-valid").V(),$("#htu21_pp").h("is-invalid").V();$("#htu21_dew").l("is-invalid").V();$("#htu21_dew").l("is-valid").V();$("#htu21_dew").h("is-valid").V();$("#htu21_pp").l("is-invalid").V();$("#htu21_pp").l("is-valid").V();$("#htu21_pp").h("is-valid").V();m.debug&&("ON"==m.debug?(D(),s.l("badge-warning"),s.h("badge-success"),s.text("ВКЛ")):"OFF"==m.debug?(H(),s.l("badge-success"),s.h("badge-warning"),s.text("ВЫКЛ")):(s.l("badge-success"),s.h("badge-danger"),s.text("НЕТ СВЯЗИ")),$(".swdeb").g("disabled"));if(m.q){b=0;for(b in m.q)h+=m.q[b]+"-";$(".ptime").text(h.substring(0,h.length-1))}h=""}function W(e){$("#"+p[e].name).l("is-invalid").V();$("#"+p[e].name).l("is-valid").V();$("#"+p[e].name).h("is-valid").V()}function q(e){$("#"+p[e].name).l("is-invalid").V();$("#"+p[e].name).l("is-valid").V();$("#"+p[e].name).h("is-invalid").V()}function D(){O.l("collapse show");O.h("collapse hide");E.l("collapse hide");E.h("collapse show");k.l("collapse hide");k.h("collapse show")}function H(){O.l("collapse hide");O.h("collapse show");E.l("collapse show");E.h("collapse hide");k.l("collapse show");k.h("collapse hide")}function X(e){for(d=0;d<p.length;d++)$("#"+p[d].name).t(e),$("#"+p[d].name).l("is-invalid").V(),$("#"+p[d].name).l("is-valid").V()}function z(){for(d=0;d<p.length;d++)$("#"+p[d].name).l("is-invalid").V(),$("#"+p[d].name).l("is-valid").V()}function P(){return $("#esp_tx").t().replace(/^[\n]+$/g,"").split(/[\n]+/)}function Q(){device.D()||$(".bt0st").click()}$(".bt0st1").click(function(){$(".bt0st").click()});function Y(){$("#esp_tx").t("")}function Z(){$("#esp_urx").t("");r=""}$(".bt0st").click(function(){g=$(".bt0st").H("value");device.D()?"on"!=g?($(".bt0st").H("value","on"),ee(),se(),ne()):($(".bt0st").H("value","off"),ee(),se(),te()):"on"!=g?($(".bt0st").H("value","on"),ee(),te()):($(".bt0st").H("value","off"),ee())});function ee(){$(".mc1").l("col-md-8 col-xl-8").V();$(".bsn0").l("col-md-4 col-xl-4").V();$(".mc1").l("noscroll collapse hide");$(".mc1").h("col-12").V()}function te(){$(".mc1").remove("col-12").V();$(".mc1").h("col-md-8 col-xl-8").V();$(".bsn0").h("col-md-4 col-xl-4").V()}function se(){$(".bsn0").l("col-12 overlay").V();$(".mc1").l("noscroll collapse hide")}function ne(){$(".bsn0").h("col-12 overlay").V();$(".mc1").h("noscroll collapse hide").V()}$(".swdeb").click(function(){1==this.checked?($(".swdebl").text("Выключить режим настройки"),this.setAttribute("disabled","true"),ce("ON"),n=!0):($(".swdebl").text("Включить режим настройки"),this.setAttribute("disabled","false"),ce("OFF"),n=!1)});function ce(e){e="/debug_mode?input="+encodeURIComponent(e)+"&";ae(e,"GET",V,10)}function de(){g=$(".bt0st").H("value");device.D()&&("on"!=g?(ne(),te()):(se(),ee()),$(".bt0st").click())}$(window).resize(function(){oe()});function oe(){g=$(".bt0st").H("value");device.D()?"on"==g?(se(),ne()):se():"on"==g?(ee(),te()):ee()}function ae(e,t,s,n){var c=new XMLHttpRequest;c.onloadend=function(){s(c.status,c.responseText)};c.ontimeout=function(){s(-1,null)};c.open(t,e,!0);c.setRequestHeader("Accept","application/json");c.timeout=200*n;c.send()}function _e(){$(".btns_lm75_1").l("badge-danger");$(".btns_lm75_1").l("badge-success");ae("/output_lm75_1.json?n="+Math.random(),"GET",V,10)}function le(){$(".btns_lm75_2").l("badge-danger");$(".btns_lm75_2").l("badge-success");ae("/output_lm75_2.json?n="+Math.random(),"GET",V,10)}function $e(){var e,t=0,s=$("#lm75sc_1"),n=$("#lm75so_1");for(e=0;5>e&&void 0!=$("#gLM75ch"+e).t();++e)$("#gLM75ch"+e).o("checked")&&(t|=1<<e);var c=s.t();var d=n.t();d>c&&0>d&&0>c?c=d=c:d>c&&(e=d,d=c,c=e);c==d&&(0>d&&0>c?d--:c++);s.t(d);n.t(c);$(".lm75thy_1").text(s.t()+" C°");$(".lm75tos_1").text(n.t()+" C°");d=parseInt(s.t());c=parseInt(n.t());ae("/input_lm75_1.json?n="+encodeURIComponent(JSON.stringify({X:[t,2*d,2*c]}))+"&","GET",V,10)}function be(){var e,t=0,s=$("#lm75sc_2"),n=$("#lm75so_2");for(e=0;5>e&&void 0!=$("#gLM752ch"+e).t();++e)$("#gLM752ch"+e).o("checked")&&(t|=1<<e);var c=s.t();var d=n.t();d>c&&0>d&&0>c?c=d=c:d>c&&(e=d,d=c,c=e);c==d&&(0>d&&0>c?d--:c++);s.t(d);n.t(c);$(".lm75thy_2").text(s.t()+" C°");$(".lm75tos_2").text(n.t()+" C°");d=parseInt(s.t());c=parseInt(n.t());ae("/input_lm75_2.json?n="+encodeURIComponent(JSON.stringify({X:[t,2*d,2*c]}))+"&","GET",V,10)}function ie(){p=$("#tmpo").P();ae("/temp_out.json?n="+Math.random(),"GET",V,10)}function ue(){$("#btn1").o("disabled",!0);c=P();o="";l.Y="null";f=$("#uart_get_ch").o("checked")?1:0;for(d=0;d<c.length;d++)l.Z=c[d],1==f?ae("/uart_get?input="+encodeURIComponent(c[d])+"&","GET",pe,10):ae("/uart.json?n="+encodeURIComponent(JSON.stringify(l))+"&","GET",pe,10)}function pe(e,t){a=$("#scntf").P();$("#btn1").o("disabled",!1);if(200!=e)r+="Send command error\n";else{if("string"===typeof t)try{l=JSON.parse(t)}catch(e){return 0}else l.Y="null",l.Z="null";r=""==l.Y?r+"ACK\n":r+(l.Y+"\n")}var s=$("#esp_urx");""!=s.t()?s.t(s.t()+r):s.t(r);r=""}window.onload=function(){$(".bt0st").H("value","off");$(".navia").h("list-group-item list-group-item-action bg-light border");$("#esp_tx").t("wsbuser.prints(node.heap());");$("#esp_urx").t("");s=setInterval(T,3e3);d=0;Q()};
