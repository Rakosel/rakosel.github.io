var e=!1,t,s,n=!1,c,o,d,h,a,l,r="",m="",_={},g={},b={},i=0,u=!1,f=0,p=0,v=2e3,I=[],N=[],M=[],O=[];I=[0,1,2,4,5,16,17,20];M=[3,8,9,18,19,21];N=[6,7,12,13];var w,E,k;w=$(".sideset");E=$(".macnt");k=$(".setcnt");cnftmp=$(".scntf");function C(){var e="/otp_mode?input="+encodeURIComponent("Wr345")+"&";ae(e,"GET",V,30)}function G(){var e=$("#btnsens_val").t(),t;if(1!=f)for(t=0;t<e;t++){var s="/otp_mode?input="+encodeURIComponent("GiveMeas")+"&";ae(s,"GET",V,50)}}function R(){var e="/otp_mode?input="+encodeURIComponent("Rd345")+"&";ae(e,"GET",V,30)}function T(){0==n&&$("#autmp").o("checked")&&(ae("/get_rtc.json?n="+Math.random(),"GET",V,30),ie())}function x(){var e={l:[Math.floor(Date.now()/1e3),0,0]};console.log(e);ae("/set_rtc.json?n="+encodeURIComponent(JSON.stringify(e))+"&","GET",V,10)}function j(){var e=$("#htu21d_ht option:selected").t(),t=$("#htu21d_m option:selected").t();$(".btns_htu21d")._("badge-success");$(".btns_htu21d")._("badge-danger");ae("/input_htu21d.json?n="+encodeURIComponent(JSON.stringify({$:[t,e]}))+"&","GET",V,10)}function y(){$(".btns_htu21d")._("badge-success");$(".btns_htu21d")._("badge-danger");ae("/output_htu21d.json?n="+Math.random(),"GET",V,10)}function F(){var e=$("#sht30_ht option:selected").t(),t=$("#sht30_m option:selected").t(),s=$("#sht30_scr option:selected").t(),n=$("#sht30_rep option:selected").t(),c=$("#sht30_mps_sel option:selected").t();$(".btns_sht30")._("badge-success");$(".btns_sht30")._("badge-danger");input_sht30={i:[e,t,s,n,c]};ae("/input_sht30_1.json?n="+encodeURIComponent(JSON.stringify(input_sht30))+"&","GET",V,10)}function S(){var e=$("#sht31_ht option:selected").t(),t=$("#sht31_m option:selected").t(),s=$("#sht31_scr option:selected").t(),n=$("#sht31_rep option:selected").t(),c=$("#sht31_mps_sel option:selected").t();$(".btns_sht31")._("badge-success");$(".btns_sht31")._("badge-danger");input_sht31={u:[e,t,s,n,c]};ae("/input_sht30_2.json?n="+encodeURIComponent(JSON.stringify(input_sht31))+"&","GET",V,10)}function U(){$(".btns_sht30_1")._("badge-success");$(".btns_sht30_1")._("badge-danger");ae("/output_sht30_1.json?n="+Math.random(),"GET",V,10)}function J(){$(".btns_sht31")._("badge-success");$(".btns_sht31")._("badge-danger");ae("/output_sht30_2.json?n="+Math.random(),"GET",V,10)}function B(){var e=$("#bm1s_m option:selected").t(),t=$("#bm1s_osrs option:selected").t(),s=$("#bm1s_f option:selected").t(),n=$("#bm1_t_st option:selected").t(),c=$("#bm_alt").t();$(".btns_bme280_1")._("badge-success");$(".btns_bme280_1")._("badge-danger");0==$.p(c)?$(".btns_bme280_1").h("badge-danger").text("Ошибка (смотри выше)"):(input_bme280={m:[e,t,s,n,c]},ae("/input_bme280_1.json?n="+encodeURIComponent(JSON.stringify(input_bme280))+"&","GET",V,10))}function K(){var e=$("#bm2s_m option:selected").t(),t=$("#bm2s_osrs option:selected").t(),s=$("#bm2s_f option:selected").t(),n=$("#bm2_t_st option:selected").t(),c=$("#bm_alt").t();$(".btns_bme280_2")._("badge-success");$(".btns_bme280_2")._("badge-danger");0==$.p(c)?$(".btns_bme280_2").h("badge-danger").text("Ошибка (смотри выше)"):(input_bme280={m:[e,t,s,n,c]},ae("/input_bme280_2.json?n="+encodeURIComponent(JSON.stringify(input_bme280))+"&","GET",V,10))}function L(){$(".btns_bme280_1")._("badge-success");$(".btns_bme280_1")._("badge-danger");ae("/output_bme280_1.json?n="+Math.random(),"GET",V,10)}function A(){$(".btns_bme280_2")._("badge-success");$(".btns_bme280_2")._("badge-danger");ae("/output_bme280_2.json?n="+Math.random(),"GET",V,10)}function V(e,t){var s=$(".pst1"),n=$(".pst0"),c=0,o=0,d=0,a=0,l=0,_=0;if(200!=e)return n._("badge-success"),n.h("badge-danger"),n.text("Нет связи"),s._("badge-success"),s.h("badge-danger"),s.text("Нет связи"),$(".swdeb").g("disabled"),z(),console.log("Connection proplem!"),0;n._("badge-danger");s._("badge-danger");n.h("badge-success");s.h("badge-success");n.text("ОК ");s.text("ОК ");if("string"===typeof t)try{g=JSON.parse(t),console.log(e,g)}catch(p){return X(""),console.log(e,p.message),0}else return console.log("d not string"),X(""),0;if(g.v)try{var b=parseInt(g.v[0].trim(),10),i=parseInt(g.v[1].trim(),10);1==b?$("#lm75_t1_chk").o("checked",!0):$("#lm75_t1_chk").o("checked",!1);1==i?$("#lm75_t2_chk").o("checked",!0):$("#lm75_t2_chk").o("checked",!1)}catch(p){console.log(p)}g.I&&("OK"==g.I?$(".btns_lm75_1").h("badge-success").text("ОК "):$(".btns_lm75_1").h("badge-danger").text("Ошибка "));if(g.N)if(999!=parseInt(g.N[1].trim(),10)||999!=parseInt(g.N[0].trim(),10)){b=parseInt(g.N[1].trim(),10);i=parseInt(g.N[2].trim(),10);$(".lm75thy_1").text(b+" °C");$(".lm75tos_1").text(i+" °C");$("#lm75sc_1").t(b);$("#lm75so_1").t(i);n=parseInt(g.N[0].trim(),10);if($.p(n))for(b=0;4>=b;b++)n&1<<b?$("#gLM75ch"+b.toString()).o("checked",!0):$("#gLM75ch"+b.toString()).o("checked",!1);$(".btns_lm75_1").h("badge-success").text("ОК ")}else $(".btns_lm75_1").h("badge-danger").text("Ошибка ");if(g.M)if(999!=parseInt(g.M[1].trim(),10)||999!=parseInt(g.M[0].trim(),10)){b=parseInt(g.M[1].trim(),10);i=parseInt(g.M[2].trim(),10);$(".lm75thy_2").text(b+"°C");$(".lm75tos_2").text(i+"°C");$("#lm75sc_2").t(b);$("#lm75so_2").t(i);n=parseInt(g.M[0].trim(),10);if($.p(n))for(b=0;4>=b;b++)n&1<<b?$("#gLM752ch"+b.toString()).o("checked",!0):$("#gLM752ch"+b.toString()).o("checked",!1);$(".btns_lm75_2").h("badge-success").text("ОК ")}else $(".btns_lm75_2").h("badge-danger").text("Ошибка ");g.O&&("OK"==g.O?$(".btns_lm75_2").h("badge-success").text("ОК "):$(".btns_lm75_2").h("badge-danger").text("Ошибка "));g.k&&("OK"==g.k?$(".btns_bme280_1").h("badge-success").text("ОК "):$(".btns_bme280_1").h("badge-danger").text("Ошибка "));g.C&&("OK"==g.C?$(".btns_bme280_2").h("badge-success").text("ОК "):$(".btns_bme280_2").h("badge-danger").text("Ошибка "));if(g.G){console.log(g.G);f=0;if("#ERR"==g.G){f=1;m="";return}if("#OVF"==g.G){f=1;$("#esp_urx").t(m+"#OVF");m="";return}m=$("#esp_urx").t().toString()+g.G+"\n";$("#esp_urx").t(m)}g.R&&("OK"==g.R?($(".btns_otp")._("badge-danger"),$(".btns_otp").h("badge-success").text("ОК ")):($(".btns_otp")._("badge-success"),$(".btns_otp").h("badge-danger").text("Ошибка Wr345")));g.T&&("OK"==g.T?($(".btns_otp")._("badge-danger"),$(".btns_otp").h("badge-success").text("ОК ")):($(".btns_otp")._("badge-success"),$(".btns_otp").h("badge-danger").text("Ошибка Rd345")));g.j&&("OK"==g.j?$(".btns_htu21d").h("badge-success").text("ОК "):$(".btns_htu21d").h("badge-danger").text("Ошибка "));g.$&&(999!=parseInt(g.$[0],10)?($("#htu21d_st").t("0x"+Number(g.$[0]).toString(16).toUpperCase()),parseInt(g.$[0],10),$("#htu21d_m option").F("selected"),$("#htu21d_ht option").F("selected"),$("#htu21d_m [value="+g.$[0]+"]").o("selected","selected"),$("#htu21d_ht [value="+g.$[1]+"]").o("selected","selected"),$(".btns_htu21d").h("badge-success").text("ОК ")):$(".btns_htu21d").h("badge-danger").text("Ошибка "));g.S&&("OK"==g.S?$(".btns_sht30").h("badge-success").text("ОК "):$(".btns_sht30").h("badge-danger").text("Ошибка "));g.U&&("OK"==g.U?$(".btns_sht31").h("badge-success").text("ОК "):$(".btns_sht31").h("badge-danger").text("Ошибка "));g.J&&(999!=parseInt(g.J[0],10)?($("#sht30_st").t("0x"+Number(g.J[0].trim()).toString(16).toUpperCase()),parseInt(g.J[0].trim(),10),$("#sht30_ht option").F("selected"),$("#sht30_m option").F("selected"),$("#sht30_scr option").F("selected"),$("#sht30_rep option").F("selected"),$("#sht30_mps_sel option").F("selected"),$("#sht30_ht [value="+g.J[1]+"]").o("selected","selected"),$("#sht30_m [value="+g.J[2]+"]").o("selected","selected"),$("#sht30_rep [value="+g.J[3]+"]").o("selected","selected"),$("#sht30_mps_sel [value="+g.J[4]+"]").o("selected","selected"),$("#sht30_scr [value="+g.J[5]+"]").o("selected","selected"),$("#sht30_m").click(),$(".btns_sht30").h("badge-success").text("ОК ")):$(".btns_sht30").h("badge-danger").text("Ошибка "));g.B&&(999!=parseInt(g.B[0],10)?($("#sht31_st").t("0x"+Number(g.B[0]).toString(16).toUpperCase()),parseInt(g.B[0],10),$("#sht31_ht option").F("selected"),$("#sht31_m option").F("selected"),$("#sht31_scr option").F("selected"),$("#sht31_rep option").F("selected"),$("#sht31_mps_sel option").F("selected"),$("#sht31_ht [value="+g.B[1]+"]").o("selected","selected"),$("#sht31_m [value="+g.B[2]+"]").o("selected","selected"),$("#sht31_rep [value="+g.B[3]+"]").o("selected","selected"),$("#sht31_mps_sel [value="+g.B[4]+"]").o("selected","selected"),$("#sht31_scr [value="+g.B[5]+"]").o("selected","selected"),$("#sht31_m").click(),$(".btns_sht31").h("badge-success").text("ОК ")):$(".btns_sht31").h("badge-danger").text("Ошибка "));if(g.K)if(999!=parseInt(g.K[1],10)||999!=parseInt(g.K[0].trim(),10)){$("#bm1_ch").t("0x"+Number(g.K[0].trim()).toString(16).toUpperCase());var u=parseInt(g.K[1],10);$("#bm1_st").t("0x"+Number(g.K[1].trim()).toString(16).toUpperCase());$.p(u)&&(u&1?$("#gBM2801ch0").o("checked",!0):$("#gBM2801ch0").o("checked",!1),u&8?$("#gBM2801ch3").o("checked",!0):$("#gBM2801ch3").o("checked",!1),$("#bm1s_m option").F("selected"),$("#bm1s_osrs option").F("selected"),$("#bm1s_f option").F("selected"),$("#bm1_t_st option").F("selected"),$("#bm1s_m [value="+g.K[2]+"]").o("selected","selected"),$("#bm1s_osrs [value="+g.K[3]+"]").o("selected","selected"),$("#bm1s_f [value="+g.K[4]+"]").o("selected","selected"),$("#bm1_t_st [value="+g.K[5]+"]").o("selected","selected"),$(".btns_bme280_1").h("badge-success").text("ОК "))}else $("#bm1_ch").t("Ошибка"),$("#bm1_st").t("Ошибка"),$(".btns_bme280_1").h("badge-danger").text("Ошибка ");g.L&&(999!=parseInt(g.L[1],10)||999!=parseInt(g.L[0].trim(),10)?($("#bm2_ch").t("0x"+Number(g.L[0]).toString(16).toUpperCase().trim()),n=parseInt(g.L[1],10),$("#bm2_st").t("0x"+Number(g.L[1]).toString(16).toUpperCase().trim()),$.p(n)&&(n&1?($("#gBM2802ch0").o("checked",!0),console.log("#gBM2802ch0 true "+n)):($("#gBM2802ch0").o("checked",!1),console.log("#gBM2802ch0 false "+n)),u&8?$("#gBM2802ch3").o("checked",!0):$("#gBM2802ch3").o("checked",!1),$("#bm2s_m option").F("selected"),$("#bm2s_osrs option").F("selected"),$("#bm2s_f option").F("selected"),$("#bm2_t_st option").F("selected"),$("#bm2s_m [value="+g.L[2]+"]").o("selected","selected"),$("#bm2s_osrs [value="+g.L[3]+"]").o("selected","selected"),$("#bm2s_f [value="+g.L[4]+"]").o("selected","selected"),$("#bm2_t_st [value="+g.L[5]+"]").o("selected","selected"),$(".btns_bme280_2").h("badge-success").text("ОК "))):($("#bm2_ch").t("Ошибка"),$("#bm2_st").t("Ошибка"),$(".btns_bme280_2").h("badge-danger").text("Ошибка ")));if(g.A){for(b=3;b<=h.length&&b-3<=g.A.length;b++)"#ERR"==g.A[b-3]||""==g.A[b-3]||NaN==g.A[b-3]?q(b):W(b),$("#"+h[b].name).t(g.A[b-3]),O[b-3]=parseFloat(g.A[b-3]);for(b=0;b<O.length;b++)b<I.length&&NaN!=parseFloat(O[I[b]])&&(c+=Math.abs(parseFloat(O[I[b]])),a++),b<M.length&&NaN!=parseFloat(O[M[b]])&&(o+=parseFloat(O[M[b]]),l++),b<N.length&&NaN!=parseFloat(O[N[b]])&&(d+=parseFloat(O[N[b]]),_++);c/=a;o/=l;d/=_;q(0);q(1);q(2);NaN==c?q(0):W(0);NaN==d?q(1):W(1);NaN==o?q(2):W(2);$("#temperature").t(c.toString().substring(0,6));$("#humudity").t(o.toString().substring(0,6));$("#pressure").t(d.toString().substring(0,6))}$("#tm_adc")._("is-invalid").V();$("#tm_adc")._("is-valid").V();g.W&&($("#tm_adc").t(g.W),""==g.W||"#ERR"==g.W?$("#tm_adc").h("is-invalid").V():$("#tm_adc").h("is-valid").V());o=parseFloat($("#htu21_t").t());c=parseFloat($("#htu21_h").t());d=1.359*Math.pow(10,8)*Math.pow(10,-1762.39/(o+235.66));o=(133.32*d/1e3).toString();$("#htu21_pp").t(o.substring(0,5));c=(-(1762.39/(Math.log(.01*c*d)-8.1332)+235.66)).toString();$("#htu21_dew").t(c.substring(0,5));if("NaN"==o||"NaN"==c||""==o||""==c)$("#htu21_dew")._("is-invalid").V(),$("#htu21_dew")._("is-valid").V(),$("#htu21_dew").h("is-invalid").V(),$("#htu21_pp")._("is-invalid").V(),$("#htu21_pp")._("is-valid").V(),$("#htu21_pp").h("is-invalid").V();$("#htu21_dew")._("is-invalid").V();$("#htu21_dew")._("is-valid").V();$("#htu21_dew").h("is-valid").V();$("#htu21_pp")._("is-invalid").V();$("#htu21_pp")._("is-valid").V();$("#htu21_pp").h("is-valid").V();g.debug&&(console.log(g.debug),"ON"==g.debug?(D(),s._("badge-warning"),s.h("badge-success"),s.text("ВКЛ")):"OFF"==g.debug?(H(),s._("badge-success"),s.h("badge-warning"),s.text("ВЫКЛ")):(s._("badge-success"),s.h("badge-danger"),s.text("НЕТ СВЯЗИ")),$(".swdeb").g("disabled"));if(g.q){b=0;for(b in g.q)r+=g.q[b]+"-";$(".ptime").text(r.substring(0,r.length-1))}r=""}function W(e){$("#"+h[e].name)._("is-invalid").V();$("#"+h[e].name)._("is-valid").V();$("#"+h[e].name).h("is-valid").V()}function q(e){$("#"+h[e].name)._("is-invalid").V();$("#"+h[e].name)._("is-valid").V();$("#"+h[e].name).h("is-invalid").V()}function D(){E._("collapse show");E.h("collapse hide");w._("collapse hide");w.h("collapse show");k._("collapse hide");k.h("collapse show")}function H(){E._("collapse hide");E.h("collapse show");w._("collapse show");w.h("collapse hide");k._("collapse show");k.h("collapse hide")}function X(e){for(o=0;o<h.length;o++)$("#"+h[o].name).t(e),$("#"+h[o].name)._("is-invalid").V(),$("#"+h[o].name)._("is-valid").V()}function z(){for(o=0;o<h.length;o++)$("#"+h[o].name)._("is-invalid").V(),$("#"+h[o].name)._("is-valid").V()}function P(){return $("#esp_tx").t().replace(/^[\n]+$/g,"").split(/[\n]+/)}function Q(){device.D()||$(".bt0st").click()}$(".bt0st1").click(function(){$(".bt0st").click()});function Y(){$("#esp_tx").t("")}function Z(){$("#esp_urx").t("");m=""}$(".bt0st").click(function(){f=$(".bt0st").H("value");device.D()?"on"!=f?($(".bt0st").H("value","on"),ee(),se(),ne()):($(".bt0st").H("value","off"),ee(),se(),te()):"on"!=f?($(".bt0st").H("value","on"),ee(),te()):($(".bt0st").H("value","off"),ee())});function ee(){$(".mc1")._("col-md-8 col-xl-8").V();$(".bsn0")._("col-md-4 col-xl-4").V();$(".mc1")._("noscroll collapse hide");$(".mc1").h("col-12").V()}function te(){$(".mc1").remove("col-12").V();$(".mc1").h("col-md-8 col-xl-8").V();$(".bsn0").h("col-md-4 col-xl-4").V()}function se(){$(".bsn0")._("col-12 overlay").V();$(".mc1")._("noscroll collapse hide")}function ne(){$(".bsn0").h("col-12 overlay").V();$(".mc1").h("noscroll collapse hide").V()}$(".swdeb").click(function(){1==this.checked?($(".swdebl").text("Выключить режим настройки"),this.setAttribute("disabled","true"),ce("ON"),n=!0):($(".swdebl").text("Включить режим настройки"),this.setAttribute("disabled","false"),ce("OFF"),n=!1)});function ce(e){e="/debug_mode?input="+encodeURIComponent(e)+"&";ae(e,"GET",V,10)}function oe(){f=$(".bt0st").H("value");device.D()&&("on"!=f?(ne(),te()):(se(),ee()),$(".bt0st").click())}$(window).resize(function(){de()});function de(){f=$(".bt0st").H("value");device.D()?"on"==f?(se(),ne()):se():"on"==f?(ee(),te()):ee()}function ae(e,t,s,n){console.log(e);var c=new XMLHttpRequest;c.onloadend=function(){s(c.status,c.responseText)};c.ontimeout=function(){s(-1,null)};c.open(t,e,!0);c.setRequestHeader("Accept","application/json");c.timeout=200*n;c.send()}function le(){$(".btns_lm75_1")._("badge-danger");$(".btns_lm75_1")._("badge-success");ae("/output_lm75_1.json?n="+Math.random(),"GET",V,10)}function _e(){$(".btns_lm75_2")._("badge-danger");$(".btns_lm75_2")._("badge-success");ae("/output_lm75_2.json?n="+Math.random(),"GET",V,10)}function $e(){var e,t=0,s=$("#lm75sc_1"),n=$("#lm75so_1");for(e=0;5>e&&void 0!=$("#gLM75ch"+e).t();++e)$("#gLM75ch"+e).o("checked")&&(t|=1<<e);var c=s.t();var o=n.t();console.log(c+" "+o);o>c&&0>o&&0>c?(c=o=c,console.log("thyst1>tos1 && (thyst1<0) && (tos1<0)"+c+" "+o)):o>c&&(e=o,o=c,c=e,console.log("thyst1>tos1"+c+" "+o));c==o&&(0>o&&0>c?o--:c++);s.t(o);n.t(c);$(".lm75thy_1").text(s.t()+" C°");$(".lm75tos_1").text(n.t()+" C°");o=parseInt(s.t());c=parseInt(n.t());e={X:[t,2*o,2*c]};ae("/input_lm75_1.json?n="+encodeURIComponent(JSON.stringify(e))+"&","GET",V,10);console.log(JSON.stringify(e))}function be(){var e,t=0,s=$("#lm75sc_2"),n=$("#lm75so_2");for(e=0;5>e&&void 0!=$("#gLM752ch"+e).t();++e)$("#gLM752ch"+e).o("checked")&&(t|=1<<e);var c=s.t();var o=n.t();console.log(c+" "+o);o>c&&0>o&&0>c?(c=o=c,console.log("thyst1>tos1 && (thyst1<0) && (tos1<0)"+c+" "+o)):o>c&&(e=o,o=c,c=e,console.log("thyst1>tos1"+c+" "+o));c==o&&(0>o&&0>c?o--:c++);s.t(o);n.t(c);$(".lm75thy_2").text(s.t()+" C°");$(".lm75tos_2").text(n.t()+" C°");o=parseInt(s.t());c=parseInt(n.t());e={X:[t,2*o,2*c]};ae("/input_lm75_2.json?n="+encodeURIComponent(JSON.stringify(e))+"&","GET",V,10);console.log(JSON.stringify(e))}function ie(){h=$("#tmpo").P();ae("/temp_out.json?n="+Math.random(),"GET",V,10)}function ue(){$("#btn1").o("disabled",!0);c=P();d="";_.Y="null";p=$("#uart_get_ch").o("checked")?1:0;for(o=0;o<c.length;o++)_.Z=c[o],1==p?ae("/uart_get?input="+encodeURIComponent(c[o])+"&","GET",pe,10):ae("/uart.json?n="+encodeURIComponent(JSON.stringify(_))+"&","GET",pe,10)}function pe(e,t){a=$("#scntf").P();$("#btn1").o("disabled",!1);if(200!=e)m+="Send command error\n",console.log("Connection proplem!");else{if("string"===typeof t){console.log("priem ok!");try{_=JSON.parse(t)}catch(n){return console.log(n),0}}else _.Y="null",_.Z="null";console.log(_);m=""==_.Y?m+"ACK\n":m+(_.Y+"\n")}var s=$("#esp_urx");""!=s.t()?s.t(s.t()+m):s.t(m);console.log(m);m=""}window.onload=function(){$(".bt0st").H("value","off");$(".navia").h("list-group-item list-group-item-action bg-light border");$("#esp_tx").t("wsbuser.prints(node.heap());");$("#esp_urx").t("");s=setInterval(T,3e3);o=0;Q()};
