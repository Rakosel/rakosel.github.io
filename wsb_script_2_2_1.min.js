var e=false,s,t,n=false,a,c,l;var O,d,o;var k="",G="";var i={};var C={};var _={};var r=0,b=false;var R=0;var u=0;var f=2e3;let T=new Array;let x=new Array;let j=new Array;let y=new Array;T=[0,1,2,4,5,16,17,20];j=[3,8,9,18,19,21];x=[6,7,12,13];var p,h,m;p=$(".sideset");h=$(".macnt");m=$(".setcnt");cnftmp=$(".scntf");function v(){var e="/otp_mode?input="+encodeURIComponent("Wr345")+"&";de(e,"GET",V,30)}function g(){var e=$("#btnsens_val").t();var s;var t=0;if(R==1){return}for(t=0;t<e;t++){s="/otp_mode?input="+encodeURIComponent("GiveMeas")+"&";de(s,"GET",V,50)}}function I(){var e="/otp_mode?input="+encodeURIComponent("Rd345")+"&";de(e,"GET",V,30)}function N(){if(n==false&&$("#autmp").l("checked")){de("/get_rtc.json?n="+Math.random(),"GET",V,30);$e()}}function M(){var e={o:[Math.floor(Date.now()/1e3),0,0]};de("/set_rtc.json?n="+encodeURIComponent(JSON.stringify(e))+"&","GET",V,10)}function w(){var e=$("#htu21d_ht option:selected").t();var s=$("#htu21d_m option:selected").t();$(".btns_htu21d").i("badge-success");$(".btns_htu21d").i("badge-danger");var t={_:[s,e]};de("/input_htu21d.json?n="+encodeURIComponent(JSON.stringify(t))+"&","GET",V,10)}function E(){$(".btns_htu21d").i("badge-success");$(".btns_htu21d").i("badge-danger");de("/output_htu21d.json?n="+Math.random(),"GET",V,10)}function F(){var e=$("#sht30_ht option:selected").t();var s=$("#sht30_m option:selected").t();var t=$("#sht30_scr option:selected").t();var n=$("#sht30_rep option:selected").t();var a=$("#sht30_mps_sel option:selected").t();$(".btns_sht30").i("badge-success");$(".btns_sht30").i("badge-danger");input_sht30={$:[e,s,t,n,a]};de("/input_sht30_1.json?n="+encodeURIComponent(JSON.stringify(input_sht30))+"&","GET",V,10)}function U(){var e=$("#sht31_ht option:selected").t();var s=$("#sht31_m option:selected").t();var t=$("#sht31_scr option:selected").t();var n=$("#sht31_rep option:selected").t();var a=$("#sht31_mps_sel option:selected").t();$(".btns_sht31").i("badge-success");$(".btns_sht31").i("badge-danger");input_sht31={u:[e,s,t,n,a]};de("/input_sht30_2.json?n="+encodeURIComponent(JSON.stringify(input_sht31))+"&","GET",V,10)}function S(){$(".btns_sht30_1").i("badge-success");$(".btns_sht30_1").i("badge-danger");de("/output_sht30_1.json?n="+Math.random(),"GET",V,10)}function J(){$(".btns_sht31").i("badge-success");$(".btns_sht31").i("badge-danger");de("/output_sht30_2.json?n="+Math.random(),"GET",V,10)}function K(){var e=$("#bm1s_m option:selected").t();var s=$("#bm1s_osrs option:selected").t();var t=$("#bm1s_f option:selected").t();var n=$("#bm1_t_st option:selected").t();var a=$("#bm_alt").t();$(".btns_bme280_1").i("badge-success");$(".btns_bme280_1").i("badge-danger");if($.p(a)==false){$(".btns_bme280_1").h("badge-danger").text("Ошибка (смотри выше)");return}input_bme280={m:[e,s,t,n,a]};de("/input_bme280_1.json?n="+encodeURIComponent(JSON.stringify(input_bme280))+"&","GET",V,10)}function L(){var e=$("#bm2s_m option:selected").t();var s=$("#bm2s_osrs option:selected").t();var t=$("#bm2s_f option:selected").t();var n=$("#bm2_t_st option:selected").t();var a=$("#bm_alt").t();$(".btns_bme280_2").i("badge-success");$(".btns_bme280_2").i("badge-danger");if($.p(a)==false){$(".btns_bme280_2").h("badge-danger").text("Ошибка (смотри выше)");return}input_bme280={m:[e,s,t,n,a]};de("/input_bme280_2.json?n="+encodeURIComponent(JSON.stringify(input_bme280))+"&","GET",V,10)}function B(){$(".btns_bme280_1").i("badge-success");$(".btns_bme280_1").i("badge-danger");de("/output_bme280_1.json?n="+Math.random(),"GET",V,10)}function A(){$(".btns_bme280_2").i("badge-success");$(".btns_bme280_2").i("badge-danger");de("/output_bme280_2.json?n="+Math.random(),"GET",V,10)}function V(e,s){var t=$(".pst1");var n=$(".pst0");var a=0;var c=0;var l=0;var d=0;var o=0;var i=0;var _=0;var r=0;if(e!=200){n.i("badge-success");n.h("badge-danger");n.text("Нет связи");t.i("badge-success");t.h("badge-danger");t.text("Нет связи");$(".swdeb").v("disabled");z();return 0}else{n.i("badge-danger");t.i("badge-danger");n.h("badge-success");t.h("badge-success");n.text("ОК ");t.text("ОК ");if(typeof s==="string"){try{C=JSON.parse(s)}catch(e){X("");return 0}}else{X("");return 0}}if(C["g"]){try{var b=parseInt(C.g[0].trim(),10);var u=parseInt(C.g[1].trim(),10);if(b==1){$("#lm75_t1_chk").l("checked",true)}else{$("#lm75_t1_chk").l("checked",false)}if(u==1){$("#lm75_t2_chk").l("checked",true)}else{$("#lm75_t2_chk").l("checked",false)}}catch(e){}}if(C["I"]){if(C.I=="OK"){$(".btns_lm75_1").h("badge-success").text("ОК ")}else{$(".btns_lm75_1").h("badge-danger").text("Ошибка ")}}if(C["N"]){if(parseInt(C.N[1].trim(),10)!=999||parseInt(C.N[0].trim(),10)!=999){var b=parseInt(C.N[1].trim(),10);var u=parseInt(C.N[2].trim(),10);$(".lm75thy_1").text(b+" °C");$(".lm75tos_1").text(u+" °C");$("#lm75sc_1").t(b);$("#lm75so_1").t(u);var f=parseInt(C.N[0].trim(),10);var p=0;if($.p(f)){for(p=0;p<=4;p++){if(f&1<<p){$("#gLM75ch"+p.toString()).l("checked",true)}else{$("#gLM75ch"+p.toString()).l("checked",false)}}}$(".btns_lm75_1").h("badge-success").text("ОК ")}else{$(".btns_lm75_1").h("badge-danger").text("Ошибка ")}}if(C["M"]){if(parseInt(C.M[1].trim(),10)!=999||parseInt(C.M[0].trim(),10)!=999){var b=parseInt(C.M[1].trim(),10);var u=parseInt(C.M[2].trim(),10);$(".lm75thy_2").text(b+"°C");$(".lm75tos_2").text(u+"°C");$("#lm75sc_2").t(b);$("#lm75so_2").t(u);var f=parseInt(C.M[0].trim(),10);var p=0;if($.p(f)){for(p=0;p<=4;p++){if(f&1<<p){$("#gLM752ch"+p.toString()).l("checked",true)}else{$("#gLM752ch"+p.toString()).l("checked",false)}}}$(".btns_lm75_2").h("badge-success").text("ОК ")}else{$(".btns_lm75_2").h("badge-danger").text("Ошибка ")}}if(C["O"]){if(C.O=="OK"){$(".btns_lm75_2").h("badge-success").text("ОК ")}else{$(".btns_lm75_2").h("badge-danger").text("Ошибка ")}}if(C["k"]){if(C.k=="OK"){$(".btns_bme280_1").h("badge-success").text("ОК ")}else{$(".btns_bme280_1").h("badge-danger").text("Ошибка ")}}if(C["G"]){if(C.G=="OK"){$(".btns_bme280_2").h("badge-success").text("ОК ")}else{$(".btns_bme280_2").h("badge-danger").text("Ошибка ")}}if(C["C"]){R=0;if(C.C=="#ERR"){R=1;G="";return}if(C.C=="#OVF"){R=1;$("#esp_urx").t(G+"#OVF");G="";return}G=$("#esp_urx").t().toString()+C.C+"\n";$("#esp_urx").t(G)}if(C["R"]){if(C.R=="OK"){$(".btns_otp").i("badge-danger");$(".btns_otp").h("badge-success").text("ОК ")}else{$(".btns_otp").i("badge-success");$(".btns_otp").h("badge-danger").text("Ошибка Wr345")}}if(C["T"]){if(C.T=="OK"){$(".btns_otp").i("badge-danger");$(".btns_otp").h("badge-success").text("ОК ")}else{$(".btns_otp").i("badge-success");$(".btns_otp").h("badge-danger").text("Ошибка Rd345")}}if(C["j"]){if(C.j=="OK"){$(".btns_htu21d").h("badge-success").text("ОК ")}else{$(".btns_htu21d").h("badge-danger").text("Ошибка ")}}if(C["_"]){if(parseInt(C._[0],10)!=999){$("#htu21d_st").t("0x"+Number(C._[0]).toString(16).toUpperCase());var h=parseInt(C._[0],10);$("#htu21d_m option").F("selected");$("#htu21d_ht option").F("selected");$("#htu21d_m [value="+C._[0]+"]").l("selected","selected");$("#htu21d_ht [value="+C._[1]+"]").l("selected","selected");$(".btns_htu21d").h("badge-success").text("ОК ")}else{$(".btns_htu21d").h("badge-danger").text("Ошибка ")}}if(C["U"]){if(C.U=="OK"){$(".btns_sht30").h("badge-success").text("ОК ")}else{$(".btns_sht30").h("badge-danger").text("Ошибка ")}}if(C["S"]){if(C.S=="OK"){$(".btns_sht31").h("badge-success").text("ОК ")}else{$(".btns_sht31").h("badge-danger").text("Ошибка ")}}if(C["J"]){if(parseInt(C.J[0],10)!=999){$("#sht30_st").t("0x"+Number(C.J[0].trim()).toString(16).toUpperCase());var m=parseInt(C.J[0].trim(),10);$("#sht30_ht option").F("selected");$("#sht30_m option").F("selected");$("#sht30_scr option").F("selected");$("#sht30_rep option").F("selected");$("#sht30_mps_sel option").F("selected");$("#sht30_ht [value="+C.J[1]+"]").l("selected","selected");$("#sht30_m [value="+C.J[2]+"]").l("selected","selected");$("#sht30_rep [value="+C.J[3]+"]").l("selected","selected");$("#sht30_mps_sel [value="+C.J[4]+"]").l("selected","selected");$("#sht30_scr [value="+C.J[5]+"]").l("selected","selected");$("#sht30_m").click();$(".btns_sht30").h("badge-success").text("ОК ")}else{$(".btns_sht30").h("badge-danger").text("Ошибка ")}}if(C["K"]){if(parseInt(C.K[0],10)!=999){$("#sht31_st").t("0x"+Number(C.K[0]).toString(16).toUpperCase());var m=parseInt(C.K[0],10);$("#sht31_ht option").F("selected");$("#sht31_m option").F("selected");$("#sht31_scr option").F("selected");$("#sht31_rep option").F("selected");$("#sht31_mps_sel option").F("selected");$("#sht31_ht [value="+C.K[1]+"]").l("selected","selected");$("#sht31_m [value="+C.K[2]+"]").l("selected","selected");$("#sht31_rep [value="+C.K[3]+"]").l("selected","selected");$("#sht31_mps_sel [value="+C.K[4]+"]").l("selected","selected");$("#sht31_scr [value="+C.K[5]+"]").l("selected","selected");$("#sht31_m").click();$(".btns_sht31").h("badge-success").text("ОК ")}else{$(".btns_sht31").h("badge-danger").text("Ошибка ")}}if(C["L"]){if(parseInt(C.L[1],10)!=999||parseInt(C.L[0].trim(),10)!=999){$("#bm1_ch").t("0x"+Number(C.L[0].trim()).toString(16).toUpperCase());var v=parseInt(C.L[1],10);$("#bm1_st").t("0x"+Number(C.L[1].trim()).toString(16).toUpperCase());if($.p(v)){if(v&1){$("#gBM2801ch0").l("checked",true)}else{$("#gBM2801ch0").l("checked",false)}if(v&8){$("#gBM2801ch3").l("checked",true)}else{$("#gBM2801ch3").l("checked",false)}$("#bm1s_m option").F("selected");$("#bm1s_osrs option").F("selected");$("#bm1s_f option").F("selected");$("#bm1_t_st option").F("selected");$("#bm1s_m [value="+C.L[2]+"]").l("selected","selected");$("#bm1s_osrs [value="+C.L[3]+"]").l("selected","selected");$("#bm1s_f [value="+C.L[4]+"]").l("selected","selected");$("#bm1_t_st [value="+C.L[5]+"]").l("selected","selected");$(".btns_bme280_1").h("badge-success").text("ОК ")}}else{$("#bm1_ch").t("Ошибка");$("#bm1_st").t("Ошибка");$(".btns_bme280_1").h("badge-danger").text("Ошибка ")}}if(C["B"]){if(parseInt(C.B[1],10)!=999||parseInt(C.B[0].trim(),10)!=999){$("#bm2_ch").t("0x"+Number(C.B[0]).toString(16).toUpperCase().trim());var g=parseInt(C.B[1],10);$("#bm2_st").t("0x"+Number(C.B[1]).toString(16).toUpperCase().trim());if($.p(g)){if(g&1){$("#gBM2802ch0").l("checked",true)}else{$("#gBM2802ch0").l("checked",false)}if(v&8){$("#gBM2802ch3").l("checked",true)}else{$("#gBM2802ch3").l("checked",false)}$("#bm2s_m option").F("selected");$("#bm2s_osrs option").F("selected");$("#bm2s_f option").F("selected");$("#bm2_t_st option").F("selected");$("#bm2s_m [value="+C.B[2]+"]").l("selected","selected");$("#bm2s_osrs [value="+C.B[3]+"]").l("selected","selected");$("#bm2s_f [value="+C.B[4]+"]").l("selected","selected");$("#bm2_t_st [value="+C.B[5]+"]").l("selected","selected");$(".btns_bme280_2").h("badge-success").text("ОК ")}}else{$("#bm2_ch").t("Ошибка");$("#bm2_st").t("Ошибка");$(".btns_bme280_2").h("badge-danger").text("Ошибка ")}}a=1;if(C["A"]){for(p=3;p<=O.length&&p-3<=C.A.length;p++){if(C.A[p-3]=="#ERR"||C.A[p-3]==""||C.A[p-3]==NaN){q(p)}else{W(p)}$("#"+O[p].name).t(C.A[p-3]);y[p-3]=parseFloat(C.A[p-3])}for(p=0;p<y.length&&p<T.length;p++){if(p<T.length&&parseFloat(y[T[p]])!=NaN){o=parseFloat(y[T[p]]);if(o<0){a=-1}else{a=a*a}c+=Math.abs(o);i++}if(p<j.length&&parseFloat(y[j[p]])!=NaN){l+=parseFloat(y[j[p]]);_++}if(p<x.length&&parseFloat(y[x[p]])!=NaN){d+=parseFloat(y[x[p]]);r++}}c=c*a/i;l=l/_;d=d/r;q(0);q(1);q(2);if(c==NaN){q(0)}else{W(0)}if(d==NaN){q(1)}else{W(1)}if(l==NaN){q(2)}else{W(2)}$("#temperature").t(c.toString().substring(0,6));$("#humudity").t(l.toString().substring(0,6));$("#pressure").t(d.toString().substring(0,6))}$("#tm_adc").i("is-invalid").V();$("#tm_adc").i("is-valid").V();if(C["W"]){$("#tm_adc").t(C.W);if(C.W==""||C.W=="#ERR"){$("#tm_adc").h("is-invalid").V()}else{$("#tm_adc").h("is-valid").V()}}var I=parseFloat($("#htu21_t").t());var N=parseFloat($("#htu21_h").t());var M=1.359*Math.pow(10,8)*Math.pow(10,-1762.39/(I+235.66));var w=(M*133.32/1e3).toString();$("#htu21_pp").t(w.substring(0,5));var E=(-(1762.39/(Math.log(N*(M*.01))-8.1332)+235.66)).toString();$("#htu21_dew").t(E.substring(0,5));if(w=="NaN"||E=="NaN"||w==""||E==""){$("#htu21_dew").i("is-invalid").V();$("#htu21_dew").i("is-valid").V();$("#htu21_dew").h("is-invalid").V();$("#htu21_pp").i("is-invalid").V();$("#htu21_pp").i("is-valid").V();$("#htu21_pp").h("is-invalid").V()}$("#htu21_dew").i("is-invalid").V();$("#htu21_dew").i("is-valid").V();$("#htu21_dew").h("is-valid").V();$("#htu21_pp").i("is-invalid").V();$("#htu21_pp").i("is-valid").V();$("#htu21_pp").h("is-valid").V();if(C["debug"]){if(C.debug=="ON"){D();t.i("badge-warning");t.h("badge-success");t.text("ВКЛ")}else if(C.debug=="OFF"){H();t.i("badge-success");t.h("badge-warning");t.text("ВЫКЛ")}else{t.i("badge-success");t.h("badge-danger");t.text("НЕТ СВЯЗИ")}$(".swdeb").v("disabled")}if(C["q"]){p=0;for(p in C.q){k+=C.q[p]+"-"}$(".ptime").text(k.substring(0,k.length-1))}k=""}function W(e){$("#"+O[e].name).i("is-invalid").V();$("#"+O[e].name).i("is-valid").V();$("#"+O[e].name).h("is-valid").V()}function q(e){$("#"+O[e].name).i("is-invalid").V();$("#"+O[e].name).i("is-valid").V();$("#"+O[e].name).h("is-invalid").V()}function D(){h.i("collapse show");h.h("collapse hide");p.i("collapse hide");p.h("collapse show");m.i("collapse hide");m.h("collapse show")}function H(){h.i("collapse hide");h.h("collapse show");p.i("collapse show");p.h("collapse hide");m.i("collapse show");m.h("collapse hide")}function X(e){for(c=0;c<O.length;c++){$("#"+O[c].name).t(e);$("#"+O[c].name).i("is-invalid").V();$("#"+O[c].name).i("is-valid").V()}}function z(){for(c=0;c<O.length;c++){$("#"+O[c].name).i("is-invalid").V();$("#"+O[c].name).i("is-valid").V()}}function P(){var e=$("#esp_tx").t().replace(/^[\n]+$/g,"").split(/[\n]+/);return e}function Q(){if(!device.D()){$(".bt0st").click()}}$(".bt0st1").click(function e(){$(".bt0st").click()});function Y(){$("#esp_tx").t("")}function Z(){$("#esp_urx").t("");G=""}$(".bt0st").click(function e(){R=$(".bt0st").H("value");if(device.D()){if(R!="on"){$(".bt0st").H("value","on");ee();te();ne()}else{$(".bt0st").H("value","off");ee();te();se()}}else{if(R!="on"){$(".bt0st").H("value","on");ee();se()}else{$(".bt0st").H("value","off");ee()}}});function ee(){$(".mc1").i("col-md-8 col-xl-8").V();$(".bsn0").i("col-md-4 col-xl-4").V();$(".mc1").i("noscroll collapse hide");$(".mc1").h("col-12").V()}function se(){$(".mc1").remove("col-12").V();$(".mc1").h("col-md-8 col-xl-8").V();$(".bsn0").h("col-md-4 col-xl-4").V()}function te(){$(".bsn0").i("col-12 overlay").V();$(".mc1").i("noscroll collapse hide")}function ne(){$(".bsn0").h("col-12 overlay").V();$(".mc1").h("noscroll collapse hide").V()}$(".swdeb").click(function e(){if(this.checked==true){$(".swdebl").text("Выключить режим настройки");this.setAttribute("disabled","true");ae("ON");n=true}else{$(".swdebl").text("Включить режим настройки");this.setAttribute("disabled","false");ae("OFF");n=false}});function ae(e){var s="/debug_mode?input="+encodeURIComponent(e)+"&";de(s,"GET",V,10)}function ce(){R=$(".bt0st").H("value");if(device.D()){if(R!="on"){ne();se()}else{te();ee()}$(".bt0st").click()}}$(window).resize(function(){le()});function le(){R=$(".bt0st").H("value");if(device.D()){if(R=="on"){te();ne()}else{te()}}else{if(R=="on"){ee();se()}else{ee()}}}function de(e,s,t,n){var a=new XMLHttpRequest;a.onloadend=function(){t(a.status,a.responseText)};a.ontimeout=function(){t(-1,null)};a.open(s,e,true);a.setRequestHeader("Accept","application/json");a.timeout=n*200;a.send()}function oe(){$(".btns_lm75_1").i("badge-danger");$(".btns_lm75_1").i("badge-success");de("/output_lm75_1.json?n="+Math.random(),"GET",V,10)}function ie(){$(".btns_lm75_2").i("badge-danger");$(".btns_lm75_2").i("badge-success");de("/output_lm75_2.json?n="+Math.random(),"GET",V,10)}function _e(){var e=0;var s={};var t=0;var n=0;var a=0;var c=$("#lm75sc_1");var l=$("#lm75so_1");for(e=0;e<5&&$("#gLM75ch"+e).t()!=undefined;++e){if($("#gLM75ch"+e).l("checked")){t|=1<<e}}n=c.t();a=l.t();if(a>n&&a<0&&n<0){e=n;a=n;n=a}else if(a>n){e=a;a=n;n=e}if(n==a){if(a<0&&n<0){a--}else{n++}}c.t(a);l.t(n);$(".lm75thy_1").text(c.t()+" C°");$(".lm75tos_1").text(l.t()+" C°");a=parseInt(c.t());n=parseInt(l.t());a=a*2;n=n*2;s={X:[t,a,n]};de("/input_lm75_1.json?n="+encodeURIComponent(JSON.stringify(s))+"&","GET",V,10)}function re(){var e=0;var s={};var t=0;var n=0;var a=0;var c=$("#lm75sc_2");var l=$("#lm75so_2");for(e=0;e<5&&$("#gLM752ch"+e).t()!=undefined;++e){if($("#gLM752ch"+e).l("checked")){t|=1<<e}}n=c.t();a=l.t();if(a>n&&a<0&&n<0){e=n;a=n;n=a}else if(a>n){e=a;a=n;n=e}if(n==a){if(a<0&&n<0){a--}else{n++}}c.t(a);l.t(n);$(".lm75thy_2").text(c.t()+" C°");$(".lm75tos_2").text(l.t()+" C°");a=parseInt(c.t());n=parseInt(l.t());a=a*2;n=n*2;s={X:[t,a,n]};de("/input_lm75_2.json?n="+encodeURIComponent(JSON.stringify(s))+"&","GET",V,10)}function $e(){O=$("#tmpo").P();de("/temp_out.json?n="+Math.random(),"GET",V,10)}function be(){$("#btn1").l("disabled",true);a=P();l="";i.Y="null";if($("#uart_get_ch").l("checked")){u=1}else{u=0}for(c=0;c<a.length;c++){i.Z=a[c];if(u==1){de("/uart_get?input="+encodeURIComponent(a[c])+"&","GET",ue,10)}else{de("/uart.json?n="+encodeURIComponent(JSON.stringify(i))+"&","GET",ue,10)}}}function ue(e,s){d=$("#scntf").P();$("#btn1").l("disabled",false);if(e!=200){G+="Send command error"+"\n"}else{if(typeof s==="string"){try{i=JSON.parse(s)}catch(e){return 0}}else{i.Y="null";i.Z="null"}if(i.Y==""){G+="ACK"+"\n"}else{G+=i.Y+"\n"}}var t=$("#esp_urx");if(t.t()!=""){t.t(t.t()+G)}else{t.t(G)}G=""}window.onload=function(){$(".bt0st").H("value","off");$(".navia").h("list-group-item list-group-item-action bg-light border");$("#esp_tx").t("wsbuser.prints(node.heap());");$("#esp_urx").t("");t=setInterval(N,3e3);c=0;Q()};
